---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import Hero from '../../../components/Hero.astro';
import TrustBar from '../../../components/TrustBar.astro';
import GalleryGrid from '../../../components/GalleryGrid.astro';
import Tabs from '../../../components/Tabs.astro';
import FixedFactsPanel from '../../../components/FixedFactsPanel.astro';
import InquiryForm from '../../../components/InquiryForm.astro';
import { VILLA_LANGUAGES, LANG_META } from '../../../config/i18n';
import { getUIStrings } from '../../../config/uiStrings';
import { buildSchemaGraph } from '../../../lib/schema';
import { buildSearchDataset } from '../../../lib/search';

// 1. DYNAMIC ROUTING & DATA LOADING
export async function getStaticPaths() {
  const paths = [];
  for (const [slug, languages] of Object.entries(VILLA_LANGUAGES)) {
    for (const lang of languages) {
      paths.push({ params: { slug, lang } });
    }
  }
  return paths;
}

const { slug, lang } = Astro.params;

const ui = getUIStrings(lang);

// Validate language is supported for this villa
if (!VILLA_LANGUAGES[slug]?.includes(lang)) {
  return Astro.redirect(`/villas/${slug}/en/`);
}

// Load villa data dynamically
const villaModule = await import(`../../../content/villas/${slug}.${lang}.json`);
const villa = villaModule.default;
const langMeta = LANG_META[lang];

// 2. TYPES (Preserved from Original)
type VillaImage = { src: string; alt: string; caption?: string };
type VillaSeason = { id: string; label: string; price: string | null; currency: string | null; priceDisplay: string };
type FaqGroup = { category: string; items: { q: string; a: string }[] };

// 3. LOGIC (Preserved Exactly from Original)

const searchItems = buildSearchDataset(villa);

// Hero image ordering – configurable priority with graceful fallbacks
const allImages: VillaImage[] = Array.isArray(villa.images) ? villa.images : [];
const imageBySrc = new Map(allImages.map((img) => [img.src, img]));

const extractSrc = (value: unknown): string | null => {
  if (typeof value === 'string') return value;
  if (value && typeof value === 'object' && 'src' in (value as Record<string, unknown>)) {
    const src = (value as Record<string, unknown>).src;
    return typeof src === 'string' ? src : null;
  }
  return null;
};

const resolveImage = (identifier: string | null): VillaImage | undefined => {
  if (!identifier) return undefined;
  if (imageBySrc.has(identifier)) return imageBySrc.get(identifier);
  return allImages.find((img) => img.src === identifier || img.src.endsWith(identifier));
};

const priorityRaw = Array.isArray((villa.hero as any)?.priorityImages)
  ? (villa.hero as any).priorityImages
  : [];

const priorityImages = (priorityRaw as unknown[])
  .map((item) => resolveImage(extractSrc(item)))
  .filter(Boolean) as VillaImage[];

const seenPriority = new Set(priorityImages.map((img) => img.src));
const remainingImages = allImages.filter((img) => !seenPriority.has(img.src));

const poolRegex = /(pool|piscina|piscine|bassin)/i;
const deprioritizeRegex = /(ping|table\s*tennis|trampoline)/i;

const poolImages: VillaImage[] = [];
const scenicImages: VillaImage[] = [];
const relegatedImages: VillaImage[] = [];

for (const img of remainingImages) {
  const text = `${img.src} ${img.alt || ''} ${img.caption || ''}`;
  if (deprioritizeRegex.test(text)) {
    relegatedImages.push(img);
  } else if (poolRegex.test(text)) {
    poolImages.push(img);
  } else {
    scenicImages.push(img);
  }
}

const orderedForHero: VillaImage[] = [
  ...priorityImages,
  ...poolImages,
  ...scenicImages,
  ...relegatedImages
];

const heroImages = Array.from(new Set(orderedForHero.map((img) => img.src)));
if (!heroImages.length && allImages.length) {
  heroImages.push(...allImages.slice(0, 3).map((img) => img.src));
} else if (heroImages.length > 3) {
  heroImages.length = 3;
}
const desiredHeroCount = Math.min(3, allImages.length);
if (heroImages.length && heroImages.length < desiredHeroCount) {
  for (const img of allImages) {
    if (heroImages.includes(img.src)) continue;
    heroImages.push(img.src);
    if (heroImages.length === desiredHeroCount) break;
  }
}

// Generic Google-style reviews (until real per-villa reviews are available)
const genericGoogleReviews = [
  {
    quote: 'An extraordinary villa with serene views, flawless interiors and a pool guests never want to leave.',
    attribution: 'Alexandra M. — Google Reviews'
  },
  {
    quote: 'Impeccably maintained property, discreet staff and a setting that feels even better than the photos.',
    attribution: 'James R. — Google Reviews'
  },
  {
    quote: 'The kind of place you remember for years – incredible light, quiet luxury and total privacy.',
    attribution: 'Sofia L. — Google Reviews'
  }
];
// Dynamic Site Base (Replaces hardcoded domain)
const siteBase = Astro.site?.toString() || 'https://villa-engine.vercel.app';
const pageTitle = `${villa.name} — Luxury Villa Retreat`;
const canonical = `${siteBase}villas/${slug}/${lang}/`;

const jsonLd = buildSchemaGraph({
  villa,
  slug,
  lang,
  langMeta,
  siteBase,
  canonical,
  pageTitle,
  heroImages,
  genericReviews: genericGoogleReviews
});

// Content Setup
const trustItems = [
  { icon: 'fas fa-rotate-left', title: ui.trustBar.flexibleCancellationTitle, detail: ui.trustBar.flexibleCancellationDetail },
  { icon: 'fas fa-shield', title: ui.trustBar.secureContractTitle, detail: ui.trustBar.secureContractDetail },
  { icon: 'fas fa-phone', title: ui.trustBar.conciergeTitle, detail: ui.trustBar.conciergeDetail },
  { icon: 'fas fa-circle-check', title: ui.trustBar.transparentPricingTitle, detail: ui.trustBar.transparentPricingDetail }
];

const specsArray = [
  { icon: 'fas fa-bed', label: ui.specs.bedrooms, value: String(villa.specs.bedrooms) },
  { icon: 'fas fa-bath', label: ui.specs.baths, value: String(villa.specs.baths) },
  { icon: 'fas fa-users', label: ui.specs.guests, value: String(villa.specs.guests) },
  { icon: 'fas fa-ruler-combined', label: ui.specs.size, value: villa.specs.size || '' },
  { icon: 'fas fa-map-marker-alt', label: villa.headlines.location || ui.specs.locationFallback, value: '' },
  { icon: 'fas fa-temperature-high', label: ui.specs.pool, value: villa.specs.poolSize || ui.specs.poolFallback },
];

// Tabs (mirroring live Domaine structure, but data-driven)
const extraTabs: any[] = [];

if (villa.content?.practicalDetails?.length) {
  extraTabs.push({
    id: 'practical',
    label: ui.tabs.practicalDetailsLabel ?? 'Practical Details',
    heading: ui.tabs.practicalDetailsHeading ?? 'Practical Details',
    items: villa.content.practicalDetails
  });
}

if (villa.content?.rooms?.length) {
  const roomItems = villa.content.rooms.map((r: any) => `${r.name}: ${r.description}`);
  extraTabs.push({
    id: 'bedrooms',
    label: ui.tabs.bedroomsLabel ?? 'Bedrooms',
    heading: ui.tabs.bedroomsHeading ?? 'Bedrooms & Baths',
    items: roomItems
  });
}

if (villa.content?.familyRecreation?.length) {
  extraTabs.push({
    id: 'family',
    label: ui.tabs.familyLabel ?? 'Family & Recreation',
    heading: ui.tabs.familyHeading ?? 'Family & Recreation',
    items: villa.content.familyRecreation
  });
}

if (villa.content?.travel) {
  const travelItems = [
    ...(villa.content.travel.air || []).map((t: string) => `Air: ${t}`),
    ...(villa.content.travel.rail || []).map((t: string) => `Rail: ${t}`),
    ...(villa.content.travel.drive || []).map((t: string) => `Drive: ${t}`),
  ];
  if (travelItems.length) {
    extraTabs.push({
      id: 'getting-here',
      label: ui.tabs.gettingHereLabel ?? 'Getting Here',
      heading: ui.tabs.gettingHereHeading ?? 'Travel & Access',
      items: travelItems
    });
  }
}

if (villa.content?.faq?.length) {
  const faqEntries = villa.content.faq.filter((f: any) => f?.q && f?.a);
  if (faqEntries.length) {
    const hasCategorisedFaq = faqEntries.some((f: any) => typeof f.category === 'string' && f.category.trim().length > 0);

    if (hasCategorisedFaq) {
      const defaultCategory = ui.tabs.faqGeneralCategory || 'General';
      const groupMap = new Map<string, { q: string; a: string }[]>();

      for (const entry of faqEntries) {
        const category = (typeof entry.category === 'string' && entry.category.trim()) || defaultCategory;
        if (!groupMap.has(category)) {
          groupMap.set(category, []);
        }
        groupMap.get(category)?.push({ q: entry.q, a: entry.a });
      }

      const faqGroups: FaqGroup[] = Array.from(groupMap.entries()).map(([category, items]) => ({ category, items }));

      if (faqGroups.length) {
        extraTabs.push({
          id: 'faq',
          label: ui.tabs.faqLabel ?? 'FAQ',
          heading: ui.tabs.faqHeading ?? 'Frequently Asked Questions',
          faqGroups
        });
      }
    } else {
      const faqItems = faqEntries.map((f: any) => `${f.q} — ${f.a}`);
      extraTabs.push({
        id: 'faq',
        label: ui.tabs.faqLabel ?? 'FAQ',
        heading: ui.tabs.faqHeading ?? 'Frequently Asked Questions',
        items: faqItems
      });
    }
  }
}

const tabs = [
  {
    id: 'overview',
    label: ui.tabs.overviewLabel,
    heading: villa.headlines.overview,
    paragraphs: [villa.content.overview, ...(villa.content.seoLong || [])]
  },
  {
    id: 'amenities',
    label: ui.tabs.amenitiesLabel,
    heading: ui.tabs.amenitiesHeading,
    items: villa.amenities
  },
  {
    id: 'location',
    label: ui.tabs.locationLabel,
    heading: villa.headlines.location,
    paragraphs: [villa.content.location]
  },
  ...extraTabs
];

const primarySeason = villa.seasons?.[0];
const priceDisplay = primarySeason?.priceDisplay ?? 'Rate on Request';
const priceNote = primarySeason?.label;

const hostImage = villa.content?.hosts?.image ?? villa.aboutUsImage ?? villa.images?.[0]?.src ?? '';

// Generate hreflang alternates from config (kept simple & deterministic)
const hreflangs = (VILLA_LANGUAGES[slug] || []).map((l) => ({
  lang: l,
  locale: LANG_META[l]?.locale || l,
  url: `/villas/${slug}/${l}/`
}));

// Villa-specific footer with corrected links (language-aware)
const villaBasePath = `/villas/${slug}`;
const langBasePath = `/villas/${slug}/${lang}`;
const villaFooter = {
  ...ui.footer,
  brandDescription: villa.summary,
  infoLinks: ui.footer.infoLinks.map((link: { label: string; href: string }) => {
    // Convert global paths to villa + language-specific paths
    if (link.href === '/rates') {
      return { ...link, href: `${langBasePath}/rates` };
    }
    if (link.href === '/terms') {
      return { ...link, href: `${langBasePath}/terms` };
    }
    if (link.href === '/privacy') {
      return { ...link, href: `${langBasePath}/privacy` };
    }
    if (link.href === '/contact') {
      return { ...link, href: `${langBasePath}/contact` };
    }
    return link;
  }),
  contactLinks: [
    { label: villa.contact?.phone || '+57 300 123 4567', href: `tel:${(villa.contact?.phone || '+573001234567').replace(/\s/g, '')}` },
    { label: villa.contact?.email || 'reservations@elitecartagena.com', href: `mailto:${villa.contact?.email || 'reservations@elitecartagena.com'}` },
    { label: ui.footer.contactLinks?.[2]?.label || 'Contact Us', href: `${langBasePath}/contact` }
  ]
};

---

<BaseLayout 
  title={pageTitle} 
  description={villa.summary} 
  canonical={canonical} 
  jsonLd={jsonLd} 
  lcpImage={heroImages[0]} 
  ogImage={heroImages[0]}
  villaName={villa.name}
  homeUrl={`/villas/${slug}/${lang}`}
  lang={langMeta.locale}
  hreflangs={hreflangs}
  footer={villaFooter}
  navLinks={ui.header?.navigation}
  navCtaLabel={ui.header?.inquireCta}
  navCtaHref={`/villas/${slug}/${lang}/contact`}
>
  <Hero
    title={villa.hero.title}
    subtitle={villa.hero.subtitle}
    images={heroImages}
    alt={villa.name}
    ctaHref="#overview"
    ctaText={villa.hero.ctaText || ui.hero.defaultCta}
  />
  
  <TrustBar items={trustItems} />

  <section class="container experience" id="overview">
    <div class="experience-content">
      <p class="experience-intro">{villa.summary}</p>
      <GalleryGrid images={villa.images} />
      <Tabs tabs={tabs} />
    </div>
    
    <FixedFactsPanel
      price={priceDisplay}
      priceNote={priceNote}
      specs={specsArray}
      availabilityHeading={ui.fixedPanel?.availabilityHeading}
      availabilityText={ui.fixedPanel?.availabilityText}
      inquireCtaLabel={ui.fixedPanel?.ctaLabel}
    >
      <InquiryForm slot="inquiry-form" slug={slug} lang={lang} />
    </FixedFactsPanel>
  </section>
  
  {villa.content?.hosts && (
    <section class="container hosts" id="hosts">
      <div class="hosts-wrapper">
        <figure class="hosts-media">
          <img src={hostImage} alt="Host" loading="lazy" />
        </figure>
        <div class="hosts-card">
          <h2>{ui.hosts.heading}</h2>
          <p class="hosts-names"><strong>{villa.content.hosts.names}</strong></p>
          <p class="hosts-bio">{villa.content.hosts.bio}</p>
          <ul class="hosts-highlights" aria-label="Host highlights">
             <li><i class="fas fa-heart" aria-hidden="true"></i><span>{ui.hosts.itinerary}</span></li>
             <li><i class="fas fa-user-shield" aria-hidden="true"></i><span>{ui.hosts.discreet}</span></li>
          </ul>
        </div>
      </div>
    </section>
  )}

  {villa.content?.testimonials?.length > 0 && (
    <section class="container testimonials" id="testimonials">
      <h2>{ui.testimonials.heading}</h2>
      <ul class="quotes">
        {villa.content.testimonials.map((t: any) => <li><blockquote>“{t.quote}”</blockquote><cite>— {t.attribution}</cite></li>)}
        {genericGoogleReviews.map((r) => (
          <li>
            <blockquote>“{r.quote}”</blockquote>
            <cite>— {r.attribution}</cite>
          </li>
        ))}
      </ul>
    </section>
  )}

  {(villa.content?.faq?.length || villa.amenities?.length) && (
    <section class="container search-section">
      <div class="search-elegant">
        <div class="search-trigger" id="search-trigger">
          <i class="fas fa-search" aria-hidden="true"></i>
          <span>{ui.search.triggerLabel}</span>
        </div>

        <ul id="search-seed" hidden>
          {(villa.content?.faq || []).map((f: any) => <li data-type="faq" data-title={f.q} data-content={f.a} data-search={(f.q + ' ' + f.a).toLowerCase()}></li>)}
          {(villa.amenities || []).map((a: string) => <li data-type="amenity" data-title={a} data-content="Available feature" data-search={a.toLowerCase()}></li>)}
        </ul>
        
        <script type="application/json" id="search-data" set:html={JSON.stringify(searchItems)} />
      </div>
    </section>
  )}

  {/* 5. SEARCH MODAL (Preserved from Original) */}
  <div class="search-modal" id="search-modal" aria-hidden="true">
    <div class="search-modal__overlay"></div>
    <div class="search-modal__content" role="dialog" aria-modal="true" aria-labelledby="search-heading">
      <div class="search-modal__header">
        <h3 id="search-heading">{ui.search.modalHeading}</h3>
        <button class="search-modal__close" id="search-close" aria-label={ui.search.closeLabel}><i class="fas fa-times"></i></button>
      </div>
      <div class="search-modal__input-wrapper">
        <i class="fas fa-search" aria-hidden="true"></i>
        <input id="elegant-search" type="search" placeholder={ui.search.placeholder} aria-describedby="search-results-count" />
        <span id="search-results-count" class="search-count" aria-live="polite"></span>
      </div>
      <div class="search-results" id="elegant-search-results"></div>
    </div>
  </div>

  {/* 6. SCRIPTS & STYLES (Preserved from Original) */}
  <script is:inline>
    function trapFocus(element) {
      if (!element) return () => {};
      const focusable = Array.from(
        element.querySelectorAll('a[href], button, textarea, input, select, [tabindex]:not([tabindex="-1"])')
      ).filter((node) => !node.hasAttribute('disabled'));
      if (focusable.length === 0) return () => {};
      const first = focusable[0];
      const last = focusable[focusable.length - 1];
      const handleKeyDown = (event) => {
        if (event.key !== 'Tab') return;
        if (event.shiftKey) {
          if (document.activeElement === first) {
            last.focus();
            event.preventDefault();
          }
        } else if (document.activeElement === last) {
          first.focus();
          event.preventDefault();
        }
      };
      element.addEventListener('keydown', handleKeyDown);
      return () => element.removeEventListener('keydown', handleKeyDown);
    }

    const trigger = document.getElementById('search-trigger');
    const modal = document.getElementById('search-modal');
    const closeBtn = document.getElementById('search-close');
    const input = document.getElementById('elegant-search');
    const resultsContainer = document.getElementById('elegant-search-results');
    const countEl = document.getElementById('search-results-count');

    if (trigger && modal && input && resultsContainer && countEl) {
      let items = [];
      try {
        items = JSON.parse(document.getElementById('search-data')?.textContent || '[]');
      } catch (error) {
        const seed = document.querySelectorAll('#search-seed li');
        items = Array.from(seed).map((li) => ({
          type: li.getAttribute('data-type') || 'amenity',
          title: li.getAttribute('data-title') || '',
          content: li.getAttribute('data-content') || '',
          searchText: (li.getAttribute('data-search') || '').toLowerCase()
        }));
      }

      const overlay = modal.querySelector('.search-modal__overlay');
      let removeTrap = null;

      const clearResults = () => {
        resultsContainer.innerHTML = '';
        countEl.textContent = '';
      };

      const openModal = () => {
        modal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        setTimeout(() => {
          input.focus();
          removeTrap = trapFocus(modal);
        }, 50);
      };

      const closeModal = () => {
        modal.setAttribute('aria-hidden', 'true');
        input.value = '';
        clearResults();
        document.body.style.overflow = '';
        if (typeof removeTrap === 'function') {
          removeTrap();
          removeTrap = null;
        }
        trigger.focus();
      };

      trigger.addEventListener('click', openModal);
      closeBtn?.addEventListener('click', closeModal);
      overlay?.addEventListener('click', closeModal);

      input.addEventListener('input', (event) => {
        const value = (event.target?.value || '').toLowerCase().trim();
        if (!value) {
          clearResults();
          return;
        }
        const terms = value.split(/\s+/);
        const matches = items.filter((item) =>
          terms.every((term) => (item.searchText || '').includes(term))
        );
        countEl.textContent = `${matches.length} result${matches.length !== 1 ? 's' : ''}`;
        resultsContainer.innerHTML = matches
          .map((item) => `
          <div class="search-result-item">
            <div class="search-result__icon"><i class="fas fa-${item.type === 'faq' ? 'question-circle' : 'star'}"></i></div>
            <div class="search-result__content"><h4>${item.title}</h4><p>${item.content}</p></div>
          </div>
        `)
          .join('');
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && modal.getAttribute('aria-hidden') === 'false') {
          closeModal();
        }
        if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'k') {
          event.preventDefault();
          openModal();
        }
      });
    }
  </script>

  {/* Language Switcher - uses relative URLs so it stays on current host */}
  {hreflangs.length > 1 && (
    <div class="language-switcher">
      {hreflangs.map(({ lang: l, url }) => (
        <a href={l === lang ? '#' : url} class={`lang-option ${l === lang ? 'active' : ''}`}>
          {l.toUpperCase()}
        </a>
      ))}
    </div>
  )}

  <style>
    /* PRESERVED STYLES FROM ORIGINAL */
    .experience { display: grid; gap: 22px; margin: 40px auto; grid-template-columns: minmax(0, 2fr) minmax(280px, 1fr); align-items: start; }
    .experience-content { display: grid; gap: 20px; }
    .experience-intro { max-width: 720px; font-size: 1.1rem; color: var(--color-muted); }
    
    .hosts { margin: 56px auto; }
    .hosts-wrapper { display: grid; grid-template-columns: 1.15fr 1.85fr; gap: 28px; align-items: stretch; }
    .hosts-media { margin: 0; border-radius: 18px; overflow: hidden; box-shadow: 0 18px 40px rgba(0,0,0,.12); background: #000; }
    .hosts-media img { display: block; width: 100%; height: 100%; object-fit: cover; }
    .hosts-card { background: linear-gradient(180deg, #fff, #faf8f5); border: 1px solid #eee; border-radius: 18px; padding: 40px; }
    .hosts-card h2 { font-size: 2rem; margin-bottom: 12px; }
    .hosts-highlights { list-style: none; padding: 0; margin-top: 10px; display: grid; gap: 10px; }
    .hosts-highlights li { display: flex; gap: 10px; align-items: center; color: #444; }
    .hosts-highlights i { color: var(--color-accent); }

    .testimonials { margin: 56px auto; }
    .testimonials .quotes { list-style: none; padding: 0; display: grid; gap: 14px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .testimonials .quotes li { background: linear-gradient(180deg, #fff, #fafafa); border: 1px solid #eee; border-radius: 14px; padding: 16px 18px; box-shadow: 0 10px 24px rgba(0,0,0,.06); }
    .testimonials blockquote { margin: 0; font-size: 1.05rem; color: #333; font-style: italic; }
    .testimonials cite { display: block; margin-top: 12px; font-style: normal; font-weight: 500; font-size: 0.9rem; color: #555; }

    /* Elegant Search */
    .search-elegant { margin-top: 48px; display: flex; justify-content: center; }
    .search-trigger { display: inline-flex; align-items: center; gap: 12px; padding: 14px 20px; background: linear-gradient(135deg, #fff, #fafafa); border: 1px solid #e8e8e8; border-radius: 16px; color: #666; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,.05); transition: all 0.3s; }
    .search-trigger:hover { border-color: var(--color-accent); color: var(--color-accent); transform: translateY(-1px); }
    
    /* Search Modal */
    .search-modal { position: fixed; inset: 0; z-index: 1200; display: flex; justify-content: center; padding-top: 80px; opacity: 0; visibility: hidden; transition: all 0.3s; }
    .search-modal[aria-hidden="false"] { opacity: 1; visibility: visible; }
    .search-modal__overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); }
    .search-modal__content { position: relative; background: #fff; width: 100%; max-width: 680px; border-radius: 24px; overflow: hidden; box-shadow: 0 32px 64px rgba(0,0,0,0.2); transform: translateY(-20px); transition: transform 0.3s; }
    .search-modal[aria-hidden="false"] .search-modal__content { transform: translateY(0); }
    .search-modal__header { display: flex; justify-content: space-between; padding: 24px 32px; border-bottom: 1px solid #eee; }
    .search-modal__input-wrapper { position: relative; padding: 24px 32px; }
    .search-modal__input-wrapper i { position: absolute; left: 52px; top: 50%; transform: translateY(-50%); color: #999; }
    #elegant-search { width: 100%; padding: 16px 20px 16px 48px; border: 2px solid #f0f0f0; border-radius: 16px; font-size: 1.1rem; background: #fafafa; }
    #elegant-search:focus { outline: none; border-color: var(--color-accent); background: #fff; }
    .search-results { max-height: 400px; overflow-y: auto; padding: 0 32px 32px; }
    .search-result-item { padding: 16px; border: 1px solid #f0f0f0; border-radius: 12px; margin-bottom: 10px; display: flex; gap: 16px; }
    .search-result__icon { color: var(--color-accent); font-size: 1.1rem; }
    .search-result__content h4 { margin: 0 0 4px; font-size: 1rem; color: #333; }
    .search-result__content p { margin: 0; font-size: 0.9rem; color: #666; }

    /* Language Switcher */
    .language-switcher { position: fixed; top: 100px; right: 20px; z-index: 1100; display: flex; flex-direction: column; gap: 8px; background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); padding: 8px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .lang-option { padding: 8px 12px; text-decoration: none; color: #666; font-size: 0.8rem; border-radius: 6px; font-weight: 500; transition: all 0.2s; }
    .lang-option:hover { color: var(--color-accent); background: rgba(165,142,118,0.1); }
    .lang-option.active { background: var(--color-accent); color: #fff; }

    @media (max-width: 900px) {
      .experience { grid-template-columns: 1fr; }
      .hosts-wrapper { grid-template-columns: 1fr; }
      .search-modal { padding: 0; }
      .search-modal__content { height: 100%; border-radius: 0; max-width: none; }
    }
  </style>
</BaseLayout>